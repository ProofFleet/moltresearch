import MoltResearch.Discrepancy.Affine

/-!
# Discrepancy: translation (additive reindexing) lemmas

(Generated by Forge.)
-/

namespace MoltResearch

lemma apSumFrom_map_add (f : ℕ → ℤ) (k a d n : ℕ) :
  apSumFrom (fun x => f (x + k)) a d n = apSumFrom f (a + k) d n := by
  unfold apSumFrom
  refine Finset.sum_congr rfl ?_
  intro i hi
  simp [Nat.add_comm, Nat.add_left_comm, Nat.add_assoc]

lemma apSum_map_add (f : ℕ → ℤ) (k d n : ℕ) :
  apSum (fun x => f (x + k)) d n = apSumFrom f k d n := by
  calc
    apSum (fun x => f (x + k)) d n
        = apSumFrom (fun x => f (x + k)) 0 d n := by
            simpa using (apSum_eq_apSumFrom (f := fun x => f (x + k)) (d := d) (n := n))
    _ = apSumFrom f (0 + k) d n := by
            simpa using (apSumFrom_map_add (f := f) (k := k) (a := 0) (d := d) (n := n))
    _ = apSumFrom f k d n := by simp

lemma apSumOffset_map_add (f : ℕ → ℤ) (k d m n : ℕ) :
  apSumOffset (fun x => f (x + k)) d m n = apSumFrom f (m * d + k) d n := by
  calc
    apSumOffset (fun x => f (x + k)) d m n
        = apSumFrom (fun x => f (x + k)) (m * d) d n := by
            simpa using
              (apSumOffset_eq_apSumFrom (f := fun x => f (x + k)) (d := d) (m := m) (n := n))
    _ = apSumFrom f (m * d + k) d n := by
            simpa using (apSumFrom_map_add (f := f) (k := k) (a := m * d) (d := d) (n := n))

lemma HasDiscrepancyAtLeast.of_map_add {f : ℕ → ℤ} {k C : ℕ} :
  HasDiscrepancyAtLeast (fun x => f (x + k)) C → HasAffineDiscrepancyAtLeast f C := by
  rintro ⟨d, n, hd, hgt⟩
  refine ⟨k, d, n, hd, ?_⟩
  simpa [apSum_map_add] using hgt

lemma HasAffineDiscrepancyAtLeast.of_map_add {f : ℕ → ℤ} {k C : ℕ} :
  HasAffineDiscrepancyAtLeast (fun x => f (x + k)) C → HasAffineDiscrepancyAtLeast f C := by
  rintro ⟨a, d, n, hd, hgt⟩
  refine ⟨a + k, d, n, hd, ?_⟩
  simpa [apSumFrom_map_add] using hgt

end MoltResearch
